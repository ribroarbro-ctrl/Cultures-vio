<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Culture Share | Discover Traditions</title>
<style>
  :root {
    --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --primary: #10b981; 
    --border: #e2e8f0; --accent: #f43f5e; --shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
  }
  body.dark {
    --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --primary: #34d399; 
    --border: #334155; --shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }
  body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; }
  
  /* Header & Navigation */
  header {
    background: var(--card); border-bottom: 1px solid var(--border);
    padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
    position: sticky; top: 0; z-index: 100; backdrop-filter: blur(8px);
  }
  header h1 { font-size: 1.25rem; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
  
  .btn-circle { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border); background: var(--card); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

  main { max-width: 550px; margin: 2rem auto; padding: 0 1rem; }

  /* Input Section */
  .input-section { background: var(--card); padding: 1.5rem; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 2rem; }
  input, textarea, select { width: 100%; padding: 0.75rem 1rem; margin-bottom: 1rem; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; }
  input:focus, textarea:focus { border-color: var(--primary); ring: 2px solid var(--primary); }
  
  .upload-area { border: 2px dashed var(--border); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer; margin-bottom: 1rem; color: #64748b; font-weight: 500; }
  .upload-area:hover { border-color: var(--primary); background: rgba(16, 185, 129, 0.05); }

  .post-btn { width: 100%; padding: 0.8rem; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.2); }
  .post-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3); }

  /* Posts */
  .filter-bar { margin-bottom: 1.5rem; display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem; }
  .filter-tag { padding: 0.4rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 20px; font-size: 0.8rem; cursor: pointer; white-space: nowrap; }
  .filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

  .post-card { background: var(--card); border-radius: 24px; padding: 1.25rem; margin-bottom: 1.5rem; border: 1px solid var(--border); box-shadow: var(--shadow); }
  .post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
  .user-badge { display: flex; align-items: center; gap: 0.75rem; }
  .avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
  
  .category-label { font-size: 0.7rem; font-weight: 700; padding: 2px 10px; border-radius: 8px; background: rgba(16, 185, 129, 0.1); color: var(--primary); text-transform: uppercase; }
  .post-img { width: 100%; border-radius: 16px; margin: 1rem 0; aspect-ratio: 16/9; object-fit: cover; }
  
  .post-footer { display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 0.5rem; }
  .action-btn { background: none; border: none; color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600; font-size: 0.9rem; }
  .delete-btn { color: var(--accent); opacity: 0.6; }
  .delete-btn:hover { opacity: 1; }
</style>
</head>
<body class="light">

<header>
  <h1>CULTURE<span>SHARE</span></h1>
  <button class="btn-circle" onclick="toggleTheme()" id="theme-icon">üåô</button>
</header>

<main>
  <div class="input-section">
    <input type="text" id="username" placeholder="Who are you?">
    <select id="category">
      <option value="General">Select Category</option>
      <option value="Food">üç≤ Food & Drink</option>
      <option value="Art">üé® Art & Craft</option>
      <option value="Music">üé∂ Music & Dance</option>
      <option value="Festivals">üéâ Festivals</option>
    </select>
    <textarea id="content" rows="3" placeholder="Tell us about a tradition..."></textarea>
    
    <label for="image-input" class="upload-area" id="upload-label">
      üì∏ Tap to add an image
    </label>
    <input type="file" id="image-input" accept="image/*" style="display:none">
    
    <button class="post-btn" onclick="addPost()">Share with the World</button>
  </div>

  <div class="filter-bar" id="filter-bar">
    <div class="filter-tag active" onclick="filterPosts('All', this)">All</div>
    <div class="filter-tag" onclick="filterPosts('Food', this)">Food</div>
    <div class="filter-tag" onclick="filterPosts('Art', this)">Art</div>
    <div class="filter-tag" onclick="filterPosts('Music', this)">Music</div>
    <div class="filter-tag" onclick="filterPosts('Festivals', this)">Festivals</div>
  </div>

  <div id="posts-container"></div>
</main>

<script>
  let posts = JSON.parse(localStorage.getItem("culturePosts") || "[]");
  let currentFilter = 'All';

  function toggleTheme() {
    document.body.classList.toggle('dark');
    const isDark = document.body.classList.contains('dark');
    document.getElementById('theme-icon').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
  }

  // Improved Image Processing
  async function processImage(file) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = (e) => {
        const img = new Image();
        img.src = e.target.result;
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const scale = Math.min(1, 800 / img.width);
          canvas.width = img.width * scale;
          canvas.height = img.height * scale;
          canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
          resolve(canvas.toDataURL('image/jpeg', 0.6));
        };
      };
    });
  }

  async function addPost() {
    const user = document.getElementById('username').value.trim();
    const text = document.getElementById('content').value.trim();
    const cat = document.getElementById('category').value;
    const file = document.getElementById('image-input').files[0];

    if (!user || !text) return alert("Please fill in your name and a story.");

    const img = file ? await processImage(file) : null;
    
    const newPost = {
      id: Date.now(),
      username: user,
      content: text,
      category: cat,
      image: img,
      likes: 0,
      timestamp: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
    };

    posts.unshift(newPost); // Newest first
    saveAndRender();
    resetForm();
  }

  function likePost(id) {
    const post = posts.find(p => p.id === id);
    if(post) post.likes++;
    saveAndRender();
  }

  function deletePost(id) {
    if(confirm("Delete this story?")) {
      posts = posts.filter(p => p.id !== id);
      saveAndRender();
    }
  }

  function filterPosts(category, el) {
    currentFilter = category;
    document.querySelectorAll('.filter-tag').forEach(tag => tag.classList.remove('active'));
    el.classList.add('active');
    render();
  }

  function saveAndRender() {
    localStorage.setItem("culturePosts", JSON.stringify(posts));
    render();
  }

  function render() {
    const container = document.getElementById('posts-container');
    container.innerHTML = '';
    
    const filtered = currentFilter === 'All' ? posts : posts.filter(p => p.category === currentFilter);

    filtered.forEach(post => {
      const card = document.createElement('div');
      card.className = 'post-card';
      card.innerHTML = `
        <div class="post-header">
          <div class="user-badge">
            <div class="avatar">${post.username[0].toUpperCase()}</div>
            <div>
              <div style="font-weight: 800; font-size: 0.9rem">${post.username}</div>
              <div style="font-size: 0.7rem; opacity: 0.6">${post.timestamp}</div>
            </div>
          </div>
          <span class="category-label">${post.category}</span>
        </div>
        <p style="white-space: pre-wrap;">${post.content}</p>
        ${post.image ? `<img src="${post.image}" class="post-img">` : ''}
        <div class="post-footer">
          <button class="action-btn" onclick="likePost(${post.id})">‚ù§Ô∏è ${post.likes}</button>
          <button class="action-btn delete-btn" onclick="deletePost(${post.id})">üóëÔ∏è</button>
        </div>
      `;
      container.appendChild(card);
    });
  }

  function resetForm() {
    document.getElementById('username').value = '';
    document.getElementById('content').value = '';
    document.getElementById('image-input').value = '';
    document.getElementById('upload-label').innerText = 'üì∏ Tap to add an image';
  }

  document.getElementById('image-input').onchange = function() {
    if(this.files[0]) document.getElementById('upload-label').innerText = '‚úÖ Image Selected';
  };

  render();
</script>

</body>
</html>